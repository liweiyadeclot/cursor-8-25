# Python脚本测试说明

## 概述
本文档说明了如何测试`test_mouse_keyboard.py`脚本的各种功能。

## 测试脚本列表

### 1. 基础功能测试
- **文件**: `test_simple_python.bat`
- **功能**: 测试配置文件读取、Python脚本运行、干运行模式
- **运行**: 双击运行或命令行执行

### 2. 文件夹创建功能测试
- **文件**: `test_folder_creation.bat`
- **功能**: 专门测试文件夹创建功能
- **运行**: 双击运行或命令行执行

### 3. 综合功能测试
- **文件**: `test_all_features.bat`
- **功能**: 测试所有基础功能，包括配置文件读取、帮助信息等
- **运行**: 双击运行或命令行执行

### 4. 实际功能测试
- **文件**: `test_python_script_only.bat`
- **功能**: 实际执行鼠标键盘自动化操作
- **运行**: 双击运行或命令行执行
- **注意**: 会实际执行鼠标操作，请确保坐标配置正确

### 5. Enter键功能测试
- **文件**: `test_enter_key.bat`
- **功能**: 测试Enter键功能
- **运行**: 双击运行或命令行执行
- **注意**: 需要手动确保焦点在正确的输入框中

### 6. 打印按钮特殊处理测试
- **文件**: `test_print_button_special.bat`
- **功能**: 测试打印按钮的特殊处理逻辑
- **运行**: 双击运行或命令行执行
- **注意**: 模拟打印按钮的特殊处理流程

## 手动测试命令

### 查看帮助信息
```bash
python test_mouse_keyboard.py --help
```

### 测试配置文件读取
```bash
python -c "import json; config=json.load(open('config.json', 'r', encoding='utf-8')); print('配置:', config)"
```

### 实际执行自动化操作
```bash
python test_mouse_keyboard.py --config config.json --folder "C:\Users\FH\Documents\报销单" --file "test_file.pdf"
```

### 自定义延迟时间
```bash
python test_mouse_keyboard.py --config config.json --folder "C:\Users\FH\Documents\报销单" --file "test_file.pdf" --delay 2.0
```

## 新增功能

### 文件夹自动创建
脚本现在会在执行自动化流程之前检查保存文件路径是否存在，如果不存在会自动创建。

**功能特点**:
- 自动检查文件夹路径是否存在
- 如果不存在，自动创建文件夹（包括多层目录）
- 创建失败时会停止执行并显示错误信息
- 支持中文路径

**示例输出**:
```
文件夹路径不存在，正在创建: C:\Users\FH\Documents\报销单
✓ 文件夹创建成功: C:\Users\FH\Documents\报销单
```

### Enter键功能
脚本现在会在输入文件夹路径后自动按Enter键来进入目标目录。

**功能特点**:
- 在输入文件夹路径后自动按Enter键
- 等待1秒确保目录切换完成
- 提供详细的步骤提示信息

**示例输出**:
```
步骤3: 输入文件夹路径
正在输入文本: C:\Users\FH\Documents\报销单

步骤3.5: 按Enter键进入目标目录
```

### 打印按钮特殊处理
脚本现在对"打印确认单"按钮使用特殊的处理方式，区别于其他按钮。

**功能特点**:
- 使用固定的选择器直接查找和点击按钮
- 提供多种备用查找方法（ID、name属性、文本内容、iframe）
- 点击成功后立即执行Python脚本，不等待页面响应
- 即使点击失败也会尝试执行Python脚本作为备用方案

**示例输出**:
```
========================================
开始特殊处理打印确认单按钮...
========================================
方法1: 在主页面通过ID #BtnPrint 查找按钮
✓ 方法1成功：在主页面通过ID点击了打印确认单按钮
✓ 打印确认单按钮点击成功！
立即开始调用Python脚本处理后续操作...
```

## 安全机制

1. **鼠标移动到屏幕角落**: 可以随时中断操作
2. **5秒延迟**: 脚本开始前有5秒准备时间
3. **错误处理**: 完善的异常处理机制
4. **配置验证**: 自动验证配置文件的正确性

## 故障排除

### 常见问题

1. **'X' 或 'Y' 错误**: 配置文件中的坐标字段应该是小写的`x`和`y`
2. **文件夹创建失败**: 检查路径权限和磁盘空间
3. **Python未找到**: 确保Python已安装并添加到PATH环境变量
4. **配置文件不存在**: 确保`config.json`文件在正确位置

### 调试步骤

1. 运行`test_all_features.bat`进行基础测试
2. 检查配置文件格式是否正确
3. 验证Python环境是否正常
4. 确认坐标配置是否准确

## 注意事项

- 测试前请确保坐标配置正确
- 实际测试时请将鼠标移动到屏幕角落以便随时中断
- 建议先在测试环境中验证功能
- 文件夹创建功能需要适当的文件系统权限
