# 报销确认单打印功能说明

## 功能概述

本程序针对报销确认单按钮的点击操作，实现了专门的打印内容拦截和保存功能。当点击报销确认单按钮时，程序会：

1. 自动查找并点击报销确认单按钮
2. 使用多种方法拦截打印内容
3. 将打印内容保存为HTML文件

## 实现方法

### 1. 按钮查找策略
- 主页面查找：`#BtnPrint`
- iframe查找：在所有iframe中查找按钮
- 多种选择器：支持btnname、value等属性查找

### 2. 打印内容拦截方法

#### 方法1：新窗口监听
- 监听页面弹出事件
- 自动捕获新打开的打印窗口内容
- 保存为HTML文件

#### 方法2：网络响应监听
- 监听页面网络响应事件
- 拦截打印相关的网络请求
- 保存响应内容为HTML文件

#### 方法3：JavaScript触发
- 通过JavaScript调用打印函数
- 主动触发打印并捕获内容
- 支持多种打印函数调用

### 3. 文件保存策略
- 自动生成带时间戳的文件名
- 保存多种类型的打印内容：
  - `报销确认单_时间戳.html` - 主要打印内容
  - `打印预览_时间戳.html` - 打印预览内容
  - `打印页面_时间戳.html` - 打印页面内容
  - `当前页面_时间戳.html` - 当前页面备份

## 使用方法

1. 在Excel配置文件中，将按钮标题设置为"报销确认单"或"打印确认单"
2. 程序会自动识别并调用专门的打印处理函数
3. 打印内容会自动保存到程序运行目录

## 技术特点

- **多重保障**：使用多种方法确保能捕获到打印内容
- **自动重试**：按钮查找失败时自动重试
- **详细日志**：提供详细的操作日志便于调试
- **错误处理**：完善的异常处理机制

## 注意事项

1. 打印内容保存需要文件写入权限
2. 某些网站可能使用特殊的打印机制，可能需要调整拦截策略
3. 程序会自动监听新窗口和网络响应来捕获打印内容
