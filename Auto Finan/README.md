# 财务报销自动化系统

这是一个使用C# + Playwright实现的财务报销自动化系统，用于自动化处理电子科技大学财务系统的报销流程。

## 功能特性

- 自动读取Excel文件中的报销数据
- 支持三层循环处理逻辑
- 自动填写表单、选择下拉框、点击按钮等操作
- 支持子序列处理（复杂报销流程）
- 详细的运行日志输出

## 三层循环逻辑

1. **第一层循环**：从上至下读取Excel中的每一行数据，每一行代表一个报销单
2. **第二层循环**：从左至右处理每个单元格，根据单元格内容执行对应操作
3. **第三层循环**：当检测到子序列开始标记时，进入子序列处理模式，从上至下处理子序列中的每一行

## 文件要求

### 1. 报销信息.xlsx
包含报销数据的Excel文件，格式如下：

| 序号 | 登录界面工号 | 登录界面密码 | 省份 | 人员类型 | 子序列开始 | 工号-0 | 姓名-0 | 子序列结束 | 下一步按钮 |
|------|-------------|-------------|------|----------|------------|--------|--------|------------|------------|
| 1    | 12345       | password    | 四川省（成都） | 其他人员 | 1          | 12345  | 张三   | 1          | 下一步     |
| 2    | 67890       | password    | 北京市 | 高级职称人员 |            |        |        |            | 下一步     |

### 2. 标题-ID.xlsx
包含列标题到网页元素ID的映射关系：

| 列标题 | 元素ID |
|--------|--------|
| 登录界面工号 | uid |
| 登录界面密码 | pwd |
| 省份 | formWF_YB6_3492_yc-chr_sf |
| 人员类型 | formWF_YB6_3492_yc-chr_zc |
| 下一步按钮 | nextBtn |

## 安装和运行

1. 确保已安装.NET 8.0
2. 安装Playwright浏览器：
   ```bash
   pwsh bin/Debug/net8.0/playwright.ps1 install
   ```
3. 准备Excel文件（报销信息.xlsx和标题-ID.xlsx）
4. 运行程序：
   ```bash
   dotnet run
   ```

## 程序输出示例

```
=== 财务报销自动化系统 ===
开始初始化自动化系统...
正在加载Excel文件: 报销信息.xlsx
成功加载Excel文件，工作表: BaoXiao_Sheet
数据范围: A1:J10
正在加载标题-ID映射文件: 标题-ID.xlsx
成功加载标题-ID映射，共 15 条记录
正在启动浏览器...
浏览器启动成功
正在导航到目标页面: https://cwcx.uestc.edu.cn/WFManager/home.jsp
页面加载完成
开始处理所有报销单...

=== 开始处理第 2 行（报销单 #1）===
正在处理单元格 A2 (序号): 1
  A2: 空值，跳过
正在处理单元格 B2 (登录界面工号): 12345
  B2: 执行操作 - 登录界面工号 = 12345
  B2: 输入框填写完成
正在处理单元格 C2 (登录界面密码): password
  C2: 执行操作 - 登录界面密码 = password
  C2: 输入框填写完成
正在处理单元格 D2 (省份): 四川省（成都）
  D2: 执行操作 - 省份 = 四川省（成都）
  D2: 下拉框选择完成
检测到子序列开始标记，开始处理子序列...
=== 进入子序列处理模式 ===

--- 处理子序列第 2 行 ---
  子序列单元格 F2 (工号-0): 12345
  子序列单元格 F2: 执行操作 - 工号-0 = 12345
  子序列单元格 F2: 输入框填写完成
  子序列单元格 G2 (姓名-0): 张三
  子序列单元格 G2: 执行操作 - 姓名-0 = 张三
  子序列单元格 G2: 输入框填写完成
检测到子序列结束标记，退出子序列处理
=== 子序列处理完成 ===
=== 第 2 行处理完成 ===
```

## 注意事项

1. 确保Excel文件格式正确，第一行为列标题
2. 子序列开始列和结束列的值必须为非空才能触发子序列处理
3. 程序会自动跳过空行和空单元格
4. 如果找不到元素ID映射，程序会跳过该操作并记录日志
5. 程序支持多种元素选择器（ID、name属性等）

## 错误处理

程序包含完善的错误处理机制：
- 文件不存在时会给出明确错误提示
- 元素操作失败时会记录详细错误信息
- 浏览器操作异常时会自动重试
- 所有操作都有详细的日志输出
